{% extends 'base.html' %}

{% block extra_css %}
 <style>
     .catalog-hero {
         border-radius: 18px;
         background: radial-gradient(1000px circle at 0% 0%, rgba(229, 9, 20, 0.25), transparent 55%),
                     radial-gradient(900px circle at 100% 20%, rgba(102, 126, 234, 0.35), transparent 55%),
                     linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.65));
         border: 1px solid rgba(255,255,255,0.06);
     }

     .catalog-filter {
         background: rgba(0,0,0,0.35);
         border: 1px solid rgba(255,255,255,0.08);
         border-radius: 14px;
     }

     .series-card {
         background: #1a1a1a;
         border: 1px solid rgba(255,255,255,0.06);
         border-radius: 16px;
         overflow: hidden;
         height: 100%;
         transition: transform 0.3s, box-shadow 0.3s;
         will-change: transform;
     }

     .series-card:hover {
         transform: scale(1.05);
         box-shadow: 0 14px 40px rgba(0, 0, 0, 0.45);
     }

     .series-thumb {
         height: 210px;
         background: linear-gradient(135deg, rgba(102,126,234,0.75) 0%, rgba(118,75,162,0.75) 50%, rgba(229,9,20,0.65) 100%);
         position: relative;
         display: flex;
         align-items: flex-end;
         padding: 1rem;
     }

     .series-thumb::after {
         content: "";
         position: absolute;
         inset: 0;
         background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.65) 70%, rgba(0,0,0,0.85) 100%);
     }

     .series-thumb > * {
         position: relative;
         z-index: 1;
     }

     .series-title {
         font-weight: 800;
         letter-spacing: 0.2px;
         margin: 0;
         line-height: 1.2;
     }

     .series-meta {
         color: rgba(255,255,255,0.72);
         font-size: 0.95rem;
     }

     .chip {
         display: inline-flex;
         align-items: center;
         gap: 0.35rem;
         padding: 0.35rem 0.7rem;
         border-radius: 999px;
         font-size: 0.85rem;
         background: rgba(255,255,255,0.06);
         border: 1px solid rgba(255,255,255,0.08);
         color: rgba(255,255,255,0.85);
     }

     .chip-primary {
         background: rgba(229, 9, 20, 0.18);
         border-color: rgba(229, 9, 20, 0.35);
         color: #fff;
     }

     .btn-soft {
         background: rgba(255,255,255,0.08);
         border: 1px solid rgba(255,255,255,0.10);
         color: #fff;
     }

     .btn-soft:hover {
         background: rgba(255,255,255,0.12);
         border-color: rgba(255,255,255,0.16);
         color: #fff;
     }
 </style>
{% endblock %}

{% block content %}
 <div class="container mt-4">
     <div class="catalog-hero p-3 p-lg-4 mb-4">
         <div class="row align-items-center g-4">
             <div class="col-lg-7">
                 <h1 class="display-6 fw-bold mb-2" style="color: white !important;">Catalogue</h1>
                 <p class="text-muted mb-0" style="color: rgba(255,255,255,0.8) !important;">
                     Explore les séries et filtre par genre. Clique sur une carte pour afficher le détail.
                 </p>
             </div>
             <div class="col-lg-5">
                 <div class="catalog-filter p-2">
                     <form method="GET" action="{% url 'recommendations:series_list' %}" class="row g-2 align-items-end" id="genreFilterForm">
                         <div class="col-12">
                             <label for="genre" class="form-label mb-1" style="color: white !important;">Trier / Filtrer par genre</label>
                             <select class="form-select" id="genre" name="genre">
                                 <option value="" {% if not selected_genre %}selected{% endif %}>Tous les genres</option>
                                 {% for g in genres %}
                                     <option value="{{ g.name|default:g }}" {% if selected_genre == g.name or selected_genre == g %}selected{% endif %}>
                                         {{ g.name|default:g }}
                                     </option>
                                 {% endfor %}
                             </select>
                         </div>
                         <div class="col-12 d-flex gap-2">
                             <button type="submit" class="btn btn-primary flex-grow-1">
                                 Appliquer
                             </button>
                             <a href="{% url 'recommendations:series_list' %}" class="btn btn-soft">
                                 Réinitialiser
                             </a>
                         </div>
                         <div class="col-12">
                             {% if selected_genre %}
                                 <span class="chip chip-primary">
                                     <i class="fas fa-filter"></i> {{ selected_genre }}
                                 </span>
                             {% else %}
                                 <span class="chip">
                                     <i class="fas fa-layer-group"></i> Tous les genres
                                 </span>
                             {% endif %}
                             <span class="chip ms-2">
                                 <i class="fas fa-tv"></i> {{ series|length }} série(s)
                             </span>
                         </div>
                     </form>
                 </div>
             </div>
         </div>
     </div>

     {% if series %}
     <div class="row g-4">
         {% for serie in series %}
         <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
             <a href="{% url 'recommendations:series_detail' serie.title %}" class="text-decoration-none">
                 <div class="series-card">
                     <div class="series-thumb">
                         <div class="w-100">
                             <p class="series-title text-white">
                                 {{ serie.title|truncatewords:6 }}
                             </p>
                             <div class="series-meta mt-1">
                                 {% if serie.year %}{{ serie.year }}{% elif serie.release_year %}{{ serie.release_year }}{% else %}—{% endif %}
                             </div>
                         </div>
                     </div>

                     <div class="p-3">
                         {% if serie.genres %}
                         <div class="mb-2">
                             {% for genre in serie.genres|slice:":3" %}
                                 <span class="genre-badge">{{ genre }}</span>
                             {% endfor %}
                             {% if serie.genres|length > 3 %}
                                 <span class="chip">+{{ serie.genres|length|add:"-3" }}</span>
                             {% endif %}
                         </div>
                         {% else %}
                         <div class="mb-2">
                             <span class="chip">Genres inconnus</span>
                         </div>
                         {% endif %}

                         {% if serie.description %}
                         <p class="text-muted mb-0 small">{{ serie.description|truncatewords:16 }}</p>
                         {% else %}
                         <p class="text-muted mb-0 small" style="color: rgba(255,255,255,0.7) !important;">Voir les détails de la série.</p>
                         {% endif %}
                     </div>
                 </div>
             </a>
         </div>
         {% endfor %}
     </div>
     {% else %}
     <div class="card p-5 text-center">
         <h2 class="h4 mb-2" style="color: white !important;">Aucune série trouvée</h2>
         <p class="text-muted mb-3" style="color: rgba(255,255,255,0.8) !important;">Essaie un autre genre ou réinitialise le filtre.</p>
         <a href="{% url 'recommendations:series_list' %}" class="btn btn-primary">Voir tout le catalogue</a>
     </div>
     {% endif %}
 </div>
{% endblock %}

{% block extra_js %}
 <script>
     (function () {
         const select = document.getElementById('genre');
         const form = document.getElementById('genreFilterForm');
         if (!select || !form) return;
         select.addEventListener('change', function () {
             form.submit();
         });
     })();
 </script>
{% endblock %}